<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ®ç»™äº²çˆ±çš„æé‡‘äº­...</title>
    <link rel="stylesheet" href="style.css">
    
    <script type="importmap">
        { "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/", "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/+esm" } }
    </script>
</head>
<body>

    <div id="loader"><div class="spinner"></div><div class="loader-text">çŒ®ç»™äº²çˆ±çš„æé‡‘äº­</div></div>
    <div id="canvas-container"></div>

    <div id="title-container">
        <h1 id="display-line1" class="title-line">Merry</h1>
        <h1 id="display-line2" class="title-line">Christmas</h1>
    </div>

    <div id="ui-layer">
        <div id="top-right-controls">
            <button class="elegant-btn" id="fs-btn" onclick="toggleFullScreen()">â›¶ å…¨å±æ˜¾ç¤º</button>
            <button class="elegant-btn" id="toggle-ui-btn" onclick="toggleUI()">ğŸ‘ æ˜¾ç¤ºç•Œé¢</button>
        </div>

        <div id="left-sidebar" class="panel-hidden">
            <div class="top-left-panel">
                <div class="panel-header">è‡ªå®šä¹‰æ–‡æœ¬</div> <div class="control-row">
                    <input type="text" id="input-line1" class="input-dark" placeholder="ç¬¬ä¸€è¡Œæ–‡å­—" oninput="updateTextConfig()">
                    <input type="text" id="input-line2" class="input-dark" placeholder="ç¬¬äºŒè¡Œæ–‡å­—" oninput="updateTextConfig()">
                </div>
                <div class="control-row">
                    <span class="control-label">å­—ä½“æ ·å¼ (5ç§ç²¾é€‰)</span>
                    <select id="font-select" class="input-dark" onchange="updateTextConfig()">
                        <option value="style1">ä¹¦æ³•éŸµå‘³ (Ma Shan Zheng)</option>
                        <option value="style2">å¤å…¸è¡¬çº¿ (Cinzel)</option>
                        <option value="style3">ä¼˜é›…æ‰‹å†™ (Great Vibes)</option>
                        <option value="style4">è‰ºæœ¯çº¿æ¡ (Monoton)</option>
                        <option value="style5">å¤å¤é‡ç£… (Abril Fatface)</option>
                    </select>
                </div>
                <div class="control-row">
                    <span class="control-label">å­—ä½“å¤§å°</span>
                    <input type="range" min="50" max="250" value="100" class="slider" id="slider-fontsize" oninput="updateTextConfig()">
                </div>
                <div class="control-row">
                    <span class="control-label">å­—ä½“é¢œè‰²</span>
                    <input type="color" id="color-picker" value="#fceea7" oninput="updateTextConfig()">
                </div>

                <div class="panel-header" style="margin-top:8px;">åª’ä½“æ§åˆ¶</div>
                <button class="elegant-btn" id="play-pause-btn" onclick="toggleMusicPlay()">â–¶ æ’­æ”¾éŸ³ä¹</button>
                <div class="control-row">
                    <span class="control-label">éŸ³é‡: <span id="val-vol">50</span>%</span>
                    <input type="range" min="0" max="100" value="50" class="slider" id="slider-volume" oninput="updateVolume(this.value)">
                </div>

                <div class="panel-header" style="margin-top:8px;">ç²’å­ç³»ç»Ÿ</div>
                <div class="control-row">
                    <span class="control-label">è£…é¥°å¯†åº¦</span>
                    <input type="range" min="500" max="3000" value="3000" class="slider" id="slider-tree">
                </div>
                <div class="control-row">
                    <span class="control-label">æ˜Ÿå°˜å¯†åº¦</span>
                    <input type="range" min="500" max="5000" value="5000" class="slider" id="slider-dust">
                </div>
                <button class="elegant-btn" style="width:100%; margin-top:5px;" onclick="applyParticleSettings()">âš¡ é‡å»ºåœºæ™¯</button>
            </div>

            <div class="left-gesture-panel">
                <div class="gesture-item">
                    <div class="gesture-icon">âœŠ</div>
                    <div class="gesture-text">èšåˆ</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">âœ‹</div>
                    <div class="gesture-text">æ•£å¼€</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">ğŸ‘Œ</div>
                    <div class="gesture-text">æŠ“å–</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">â†”</div>
                    <div class="gesture-text">æ—‹è½¬</div>
                </div>
            </div>
        </div>

        <div class="bottom-left-panel panel-hidden">
            <label class="elegant-btn">
                + ä¸Šä¼ ç…§ç‰‡
                <input type="file" id="file-input" multiple accept="image/*">
            </label>
            <button class="elegant-btn" onclick="openDeleteManager()">â–£ ç…§ç‰‡åº“</button>
            <label class="elegant-btn" id="music-upload-label">
                â™« æ›´æ¢éŸ³ä¹
                <input type="file" id="music-input" accept=".mp3,audio/mpeg">
            </label>
            <button class="elegant-btn" id="toggle-cam-btn" onclick="toggleCameraDisplay()">ğŸ“· æ‘„åƒå¤´</button>
        </div>
    </div>

    <div id="gesture-hint" style="position: absolute; bottom: 10px; width: 100%; text-align: center; color: rgba(212,175,55,0.7); font-size: 10px; pointer-events: none; text-shadow: 0 0 5px #000; z-index: 5;">
        æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...
    </div>

    <div id="webcam-wrapper">
        <canvas id="webcam-canvas" width="320" height="240"></canvas>
        <div id="cam-status"></div>
    </div>
    <video id="webcam-video" autoplay playsinline muted style="display:none"></video>

    <div id="delete-manager" class="hidden">
        <div class="manager-title">ç…§ç‰‡åº“ç®¡ç†</div>
        <div id="photo-grid"></div>
        <div class="manager-actions">
            <button class="elegant-btn btn-red" onclick="clearAllPhotos()">æ¸…ç©ºæ‰€æœ‰</button>
            <button class="elegant-btn" onclick="closeDeleteManager()">å…³é—­</button>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>